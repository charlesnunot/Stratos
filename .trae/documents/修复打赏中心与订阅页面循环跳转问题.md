## 问题根因

打赏中心 (`/tip-center`) 和订阅打赏页面 (`/subscription/tip`) 之间存在**双向跳转逻辑**，但它们的判断条件**不一致**，导致特定状态下产生循环跳转。

### 循环条件

当用户**已订阅打赏** (`isTipEnabled=true`) 但**缺少收款账户** (`hasValidPaymentAccount=false`) 时：

1. **打赏中心** (`useTipGuard`): 要求同时满足 `isTipEnabled && hasValidPaymentAccount` → 判断为无权限 → 重定向到 `/subscription/tip`
2. **订阅页面**: 只检查 `isTipEnabled` → 判断为已订阅 → 重定向回 `/tip-center`
3. 形成死循环

## 修复方案

### 方案 1: 统一订阅页面的重定向条件（推荐）

修改 `subscription/tip/page.tsx`，在重定向前增加收款账户检查：

```typescript
// 从 SubscriptionContext 获取收款账户状态
const { isTipEnabled, isLoading: subscriptionLoading, hasPaymentAccount, payoutEligibility } = useSubscription()

// 计算是否有有效的收款账户
const hasValidPaymentAccount = hasPaymentAccount && payoutEligibility === 'eligible'

// 已订阅且有收款账户的用户才重定向到打赏中心
useEffect(() => {
  if (!subscriptionLoading && isTipEnabled && hasValidPaymentAccount && !shouldBypass) {
    router.replace('/tip-center')
  }
}, [subscriptionLoading, isTipEnabled, hasValidPaymentAccount, shouldBypass, router])
```

### 方案 2: 打赏中心区分拒绝原因

修改 `tip-center/layout.tsx`，根据拒绝原因跳转到不同页面：

```typescript
useEffect(() => {
  if (loading) return
  
  if (!isAuthenticated) {
    router.push(`/login?redirect=${encodeURIComponent(pathname)}`)
    return
  }
  
  if (!allowed) {
    // 根据拒绝原因跳转到不同页面
    if (denyReason === 'no_subscription') {
      router.push('/subscription/tip')
    } else if (denyReason === 'no_payment_account') {
      // 已订阅但缺少收款账户，跳转到收款账户绑定页面
      router.push('/seller/payment-accounts')
    }
  }
}, [loading, allowed, isAuthenticated, denyReason, pathname, router])
```

## 建议

建议同时实施**方案1和方案2**：

* 方案1确保订阅页面不会错误地重定向已订阅但缺少收款账户的用户

* 方案2确保用户被引导到正确的页面（绑定


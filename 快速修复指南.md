# 快速修复 EPERM 错误指南

## 当前状态

- ❌ Node.js 版本: v22.19.0（不兼容）
- ✅ 需要: Node.js 20.x LTS

## 修复步骤

### 步骤 1：下载并安装 Node.js 20 LTS

1. **访问 Node.js 官网**
   - 打开浏览器，访问：https://nodejs.org/
   - 点击下载 **Node.js 20.x LTS** 版本（推荐最新稳定版）

2. **安装 Node.js 20**
   - 运行下载的安装程序
   - 按照安装向导完成安装（使用默认设置即可）
   - **重要**：安装完成后，**关闭所有 PowerShell 和终端窗口**

3. **验证安装**
   - 打开**新的** PowerShell 窗口
   - 运行：`node -v`
   - 应该显示 `v20.x.x`（而不是 `v22.x.x`）

### 步骤 2：运行自动化设置脚本

安装 Node.js 20 后，在项目目录中运行：

```powershell
cd C:\Users\admin\Desktop\Stratos
powershell -ExecutionPolicy Bypass -File .\scripts\install-node20-and-setup.ps1
```

这个脚本会自动：
- ✅ 验证 Node.js 版本
- ✅ 清理旧的构建缓存
- ✅ 停止所有 Node.js 进程
- ✅ 重新安装项目依赖
- ✅ 启动开发服务器

### 步骤 3：验证服务器启动

脚本会在新窗口中启动开发服务器。如果看到：

```
▲ Next.js 14.0.4
- Local:        http://localhost:3000
- Ready in X.Xs
```

说明服务器启动成功！

然后在浏览器中访问：**http://localhost:3000**

## 如果脚本无法运行

如果自动化脚本无法运行，可以手动执行以下命令：

```powershell
# 1. 进入项目目录
cd C:\Users\admin\Desktop\Stratos

# 2. 清理缓存
Remove-Item -Recurse -Force .next -ErrorAction SilentlyContinue

# 3. 停止所有 Node.js 进程
Stop-Process -Name node -Force -ErrorAction SilentlyContinue

# 4. 重新安装依赖
npm install

# 5. 启动开发服务器
npm run dev
```

## 常见问题

### Q: 安装 Node.js 20 后，`node -v` 仍显示 v22.x

**A:** 需要：
1. 关闭所有 PowerShell/终端窗口
2. 重新打开新的 PowerShell 窗口
3. 再次运行 `node -v`

如果还是 v22.x，可能需要：
- 检查系统 PATH 环境变量
- 确保 Node.js 20 的安装路径在 PATH 中
- 重启计算机

### Q: 脚本提示权限错误

**A:** 以管理员身份运行 PowerShell：
1. 右键点击 PowerShell
2. 选择"以管理员身份运行"
3. 再次运行脚本

### Q: npm install 失败

**A:** 尝试：
```powershell
# 清理 npm 缓存
npm cache clean --force

# 删除 node_modules 和 package-lock.json
Remove-Item -Recurse -Force node_modules
Remove-Item package-lock.json -ErrorAction SilentlyContinue

# 重新安装
npm install
```

## 需要帮助？

如果遇到问题，请提供：
1. Node.js 版本（`node -v` 的输出）
2. 错误信息
3. 执行的命令

# 商品销售国家 - 04b 详情页与区块补丁

针对商品详情页旧数据兼容及区块标题说明问题，制定以下执行方案。

---

## 一、问题 1：商品详情页旧数据兼容

### 1.1 问题描述

当商品 `sales_countries` 为 `undefined` 或 `null`（迁移前的商品）时，详情页不渲染销售国家区块，用户无法看到「全球可售」等信息。

### 1.2 涉及位置

**文件**：`src/app/[locale]/(main)/product/[id]/ProductPageClient.tsx`  
**行号**：约 406-415

### 1.3 执行步骤

**修改前**：

```tsx
{/* Sales Countries */}
{product.sales_countries && (
  <p className="mb-2 text-sm text-muted-foreground">
    {t('salesCountries')}: {product.sales_countries.length === 0
      ? t('salesCountriesGlobal')
      : `${t('salesCountriesTo')} ${product.sales_countries.map((code: string) => getCountryDisplayName(code, locale as 'zh' | 'en')).join(', ')}`
    }
  </p>
)}
```

**修改后**：

```tsx
{/* Sales Countries */}
{(product.sales_countries == null || product.sales_countries.length === 0) ? (
  <p className="mb-2 text-sm text-muted-foreground">
    {t('salesCountries')}: {t('salesCountriesGlobal')}
  </p>
) : (
  <p className="mb-2 text-sm text-muted-foreground">
    {t('salesCountries')}: {t('salesCountriesTo')} {product.sales_countries.map((code: string) => getCountryDisplayName(code, locale as 'zh' | 'en')).join(', ')}
  </p>
)}
```

**逻辑说明**：

- `sales_countries == null` 或 `length === 0`：显示「销售国家/地区：全球可售」
- 非空数组：显示「销售国家/地区：销售至 中国, 美国, ...」

### 1.4 验证

- 有 `sales_countries: []` 或 `null` / `undefined` 的商品：显示「全球可售」
- 有 `sales_countries: ['CN','US']` 的商品：显示「销售至 中国, 美国」

---

## 二、问题 2（可选）：区块标题与说明

### 2.1 问题描述

创建页和编辑页的「销售国家/地区」区块缺少 Label 和说明，用户可能不理解该区块的用途。

### 2.2 涉及位置

- `src/app/[locale]/(main)/seller/products/create/page.tsx`：`{/* Sales Countries */}` 附近
- `src/app/[locale]/(main)/seller/products/[id]/edit/page.tsx`：`{/* Sales Countries */}` 附近

### 2.3 执行步骤

**创建页**：在 `SalesCountriesSelector` 外包一层结构，增加标题和说明

**修改前**：

```tsx
{/* Sales Countries */}
<SalesCountriesSelector
  value={formData.sales_countries}
  onChange={(countries) => setFormData({ ...formData, sales_countries: countries })}
  disabled={loading || uploading}
/>
```

**修改后**（推荐方案 B）：

```tsx
{/* Sales Countries */}
<div>
  <Label className="mb-2 block text-sm font-medium">{t('salesCountries')}</Label>
  <p className="mb-3 text-xs text-muted-foreground">{t('salesCountriesHint')}</p>
  <SalesCountriesSelector
    value={formData.sales_countries}
    onChange={(countries) => setFormData({ ...formData, sales_countries: countries })}
    disabled={loading || uploading}
  />
</div>
```

**注意**：`SalesCountriesSelector` 内部已有 `Card`，父级使用 `div` 包裹即可，避免双重 Card，保持与可见性等区块的视觉层级一致。

**编辑页**：与创建页采用相同结构修改。

### 2.4 验证

- 创建页、编辑页在「销售国家/地区」区块上方显示标题和说明，与可见性区块风格一致。

---

## 三、执行顺序建议

| 优先级 | 问题 | 说明 |
|--------|------|------|
| 1 | 问题 1：详情页旧数据兼容 | 影响迁移前商品的展示 |
| 2 | 问题 2：区块标题与说明 | 可选，提升可读性 |

---

## 四、修改文件清单

| 文件 | 修改内容 |
|------|----------|
| `src/app/[locale]/(main)/product/[id]/ProductPageClient.tsx` | 调整销售国家展示逻辑，支持 null/空数组 |
| `src/app/[locale]/(main)/seller/products/create/page.tsx` | （可选）增加 Label 和 salesCountriesHint |
| `src/app/[locale]/(main)/seller/products/[id]/edit/page.tsx` | （可选）增加 Label 和 salesCountriesHint |

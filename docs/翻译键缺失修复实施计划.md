# 翻译键缺失修复实施计划

## 问题描述

**现象**：访问 `http://localhost:3000/en` 时，页面显示未翻译的 key 文本：
- `navigation.groups`
- `common.timeHoursAgo`

**根因**：next-intl 在找不到翻译键时，会回退显示完整 key 路径（如 `namespace.key`），表明这些键在对应语言文件中不存在。

---

## 根因分析

### 1. `navigation.groups` 缺失

| 项目 | 说明 |
|------|------|
| 调用位置 | `src/components/layout/Sidebar.tsx` 第 272 行 |
| 调用方式 | `t('groups')`，其中 `t = useTranslations('navigation')` |
| 当前状态 | `navigation` 命名空间下无 `groups` 键 |
| 受影响组件 | 侧栏导航项 `/groups` 的标签 |

**en.json navigation 现有键**：home, feed, products, cart, following, favorites, insights, messages, notifications, notificationsTitle, noNotifications

**zh.json navigation**：结构相同，同样缺少 `groups`。

### 2. `common` 相对时间相关键缺失

| 项目 | 说明 |
|------|------|
| 调用位置 | Sidebar.tsx `formatLastSeen`；PostCard.tsx、PostCardView.tsx `formatPostDate` |
| 调用方式 | `tCommon('timeHoursAgo', { count })` 等，其中 `tCommon = useTranslations('common')` |
| 当前状态 | `common` 命名空间下无以下键 |
|  affected 场景 | 侧栏「最后上线」时间、帖子/评论发布时间 |

**缺失键及用法**：

| 键名 | 使用场景 | 参数 |
|------|----------|------|
| `timeJustNow` | PostCard、PostCardView：1 分钟内 | 无 |
| `timeMinutesAgo` | 同上；Sidebar formatLastSeen | `{ count }` |
| `timeHoursAgo` | 同上 | `{ count }` |
| `timeDaysAgo` | 同上 | `{ count }` |
| `timeJustNowOnline` | Sidebar：1 分钟内上线 | 无 |
| `yesterday` | Sidebar：昨天上线 | 无 |
| `timeNeverOnline` | Sidebar：从未上线 | 无 |

**说明**：`frontend-components-ui-audit.md` 记录「相对时间 i18n 已修复」，但 `en.json`/`zh.json` 中 `common` 下并未添加上述键，代码已改为使用 `t()`，翻译文件未同步更新，导致回退到 key 显示。

---

## 修复方案

### 1. 在 `navigation` 中新增 `groups`

**en.json**：在 `navigation` 对象中增加：
```json
"groups": "Groups"
```

**zh.json**：在 `navigation` 对象中增加：
```json
"groups": "群组"
```

### 2. 在 `common` 中新增相对时间相关键

**en.json**：在 `common` 对象中增加（建议放在 `sold` 之后）：
```json
"timeJustNow": "Just now",
"timeMinutesAgo": "{count} min ago",
"timeHoursAgo": "{count} hr ago",
"timeDaysAgo": "{count} day(s) ago",
"timeJustNowOnline": "Just now",
"yesterday": "Yesterday",
"timeNeverOnline": "Never online"
```

**zh.json**：在 `common` 对象中增加：
```json
"timeJustNow": "刚刚",
"timeMinutesAgo": "{count} 分钟前",
"timeHoursAgo": "{count} 小时前",
"timeDaysAgo": "{count} 天前",
"timeJustNowOnline": "刚刚",
"yesterday": "昨天",
"timeNeverOnline": "从未上线"
```

---

## 实施步骤

1. **修改 `src/messages/en.json`**
   - 在 `navigation` 中增加 `"groups": "Groups"`
   - 在 `common` 中增加 7 个相对时间键（如上）

2. **修改 `src/messages/zh.json`**
   - 在 `navigation` 中增加 `"groups": "群组"`
   - 在 `common` 中增加 7 个相对时间键（如上）

3. **验证**
   - 访问 `/en`：侧栏「Groups」正常显示，相对时间显示英文（如 "3 hr ago"）
   - 访问 `/zh`：侧栏「群组」正常显示，相对时间显示中文（如 "3 小时前"）
   - 不再出现 `navigation.groups`、`common.timeHoursAgo` 等 key 文本

---

## 涉及文件

| 文件 | 改动 |
|------|------|
| `src/messages/en.json` | navigation.groups；common 中 7 个时间键 |
| `src/messages/zh.json` | navigation.groups；common 中 7 个时间键 |

---

## 注意事项

- next-intl 支持 `{count}` 插值，无需复数形式即可工作；若需更细致复数（如 "1 minute" vs "2 minutes"），可后续改用 ICU plural 语法。
- 确保 JSON 合法（逗号、引号正确），修改后可用 `npm run build` 或启动 dev server 检查。

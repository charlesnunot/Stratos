# 商品创建、编辑、管理员审核系统检查报告

## 一、创建商品 (create/page.tsx)

### 已实现功能 ✅
- 表单字段：名称、描述、价格、货币、库存、分类、图片、颜色、尺寸、运费、成色、销售国家、可见性等
- 图片：本地上传 + 外链
- 销售国家记忆：localStorage 保存
- 货币：根据 locale 默认 CNY/USD
- 校验：必填、价格 > 0、至少 1 张图、佣金率 0–100
- 提交：status = 'pending'，插入后跳转列表

### 发现的问题

| 序号 | 问题 | 严重程度 | 说明 |
|------|------|----------|------|
| 1 | 创建时未设置 content_lang | 中 | productData 中未写入 content_lang。审核通过后 translate-after-publish 会检测并写入，getDisplayContent 在 content_lang 为空时会推断，功能可工作，但建议创建时根据 locale 写入 content_lang，便于后续翻译与展示 |
| 2 | 翻译键缺失 | 高 | t('needSellerSubscription')、t('needSellerSubscriptionDescription')、t('needSellerSubscriptionAlert')、t('goToSubscriptionPage') 在 seller 命名空间中未定义，未订阅卖家进入创建页会看到 key 文本 |

---

## 二、编辑商品 (edit/page.tsx)

### 已实现功能 ✅
- 加载商品数据、多语言显示 (getDisplayContent)
- 按 locale 写入原文或译文
- 删除图片时同步 image_from_index
- 货币选择、成色、运费、销售国家、可见性等与创建页一致

### 发现的问题

| 序号 | 问题 | 严重程度 | 说明 |
|------|------|----------|------|
| 1 | locale 切换后表单不更新 | 中 | useEffect 依赖为 [product]，未包含 locale。切换语言后 displayName/displayDescription 等不会重新计算，表单仍为旧语言内容，应增加 locale 到依赖数组 |

---

## 三、管理员商品审核 (ContentReview.tsx)

### 已实现功能 ✅
- 加载 pending 商品
- 展示：名称、描述、价格、货币、库存、运费、成色、销售国家、可见性、图片缩略图
- 审核通过前调用 migrate-product-images
- 通过后调用 approve API、translate-after-publish

### 发现的问题

| 序号 | 问题 | 严重程度 | 说明 |
|------|------|----------|------|
| 1 | 成色显示原始枚举值 | 低 | product.condition 显示 "new"、"like_new" 等，未使用 t('conditionNew') 等翻译，英文环境下不友好 |
| 2 | 可见性显示原始枚举值 | 低 | product.visibility 显示 "public"、"followers_only" 等，未使用 t('visibilityPublic') 等翻译 |

---

## 四、useImageUpload Hook

### 发现的问题

| 序号 | 问题 | 严重程度 | 说明 |
|------|------|----------|------|
| 1 | 硬编码中文 | 中 | Toast 使用 "警告"、"最多只能上传 X 张图片"、"文件 X 不是有效的图片格式" 等，英文环境下仍为中文，应改用 common 或 seller 命名空间的翻译键 |

---

## 五、修复建议汇总

### 高优先级
1. **创建页翻译键**：在 seller 中补充 needSellerSubscription、needSellerSubscriptionDescription、needSellerSubscriptionAlert、goToSubscriptionPage

### 中优先级
2. **创建页 content_lang**：创建时写入 content_lang，如 `content_lang: locale === 'zh' ? 'zh' : 'en'`
3. **编辑页 locale 依赖**：useEffect 依赖改为 [product, locale]
4. **useImageUpload 多语言**：Toast 文案改为 t()，可在 hook 中传入 t 或新增 common 键

### 低优先级
5. **审核页成色/可见性**：使用 t('conditionNew')、t('visibilityPublic') 等替代原始枚举值

---

## 六、功能流程验证

| 流程 | 状态 | 说明 |
|------|------|------|
| 创建 → 待审 | ✅ | status = 'pending' |
| 管理员审核通过 | ✅ | migrate-product-images → approve → translate-after-publish |
| 编辑 → 待审 | ✅ | 非 sold 时 status = 'pending'，清空 reviewed_by/reviewed_at |
| 审核拒绝 | ✅ | status = 'rejected' |
| 图片迁移 | ✅ | 商品通过前迁移至 Cloudinary |
| 多语言展示 | ✅ | 列表页、详情页使用 getDisplayContent |

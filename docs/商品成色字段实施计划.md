# 商品成色字段实施计划

## 一、概述

**目标**：为商品增加「成色」(condition) 字段，用于描述商品新旧程度，适用于二手/闲置等场景。

**成色语义**：商品整体状况，如全新、99新、9成新等，与颜色、尺寸不同，成色为商品级属性，非购买时可选变体。

---

## 二、成色枚举定义

建议采用固定枚举值，保证列表与筛选一致性：

| 枚举值 (DB) | 中文 | 英文 |
|-------------|------|------|
| `new` | 全新 | New |
| `like_new` | 99新 | Like New |
| `ninety_five` | 95新 | 95% New |
| `ninety` | 9成新 | 90% New |
| `eighty` | 8成新 | 80% New |
| `seventy_or_below` | 7成新及以下 | 70% or Below |

- 字段：`products.condition`，类型 `TEXT`，可空
- 默认：`null`（表示未设置，兼容老数据）
- 可选：前端空选项「—」表示不选

---

## 三、涉及文件与修改点

### 1. 数据库迁移

**新建文件**：`supabase/migrations/242_add_product_condition.sql`

```sql
-- Add condition column to products table
ALTER TABLE products
ADD COLUMN IF NOT EXISTS condition TEXT
CHECK (condition IS NULL OR condition IN ('new', 'like_new', 'ninety_five', 'ninety', 'eighty', 'seventy_or_below'));

COMMENT ON COLUMN products.condition IS '商品成色：new/like_new/ninety_five/ninety/eighty/seventy_or_below';
```

### 2. 类型定义

**文件**：`src/types/database.ts`

在 `products` 的 `Row`、`Insert`、`Update` 中增加：

```ts
condition: 'new' | 'like_new' | 'ninety_five' | 'ninety' | 'eighty' | 'seventy_or_below' | null
```

（Insert/Update 中为可选）

### 3. 创建页

**文件**：`src/app/[locale]/(main)/seller/products/create/page.tsx`

- `FormData` 接口增加：`condition: string | null`
- `formData` 初始值增加：`condition: null`
- 在「尺寸」区块附近增加成色 UI（下拉选择）
- `productData` 中增加：`condition: formData.condition || null`

### 4. 编辑页

**文件**：`src/app/[locale]/(main)/seller/products/[id]/edit/page.tsx`

- `formData` 增加：`condition: null as string | null`
- `useEffect` 加载商品时：`condition: product.condition ?? null`
- 增加与创建页一致的成色 UI（下拉选择）
- `productData` 中增加：`condition: formData.condition || null`

### 5. 商品详情页

**文件**：`src/app/[locale]/(main)/product/[id]/ProductPageClient.tsx`

在价格、库存等基础信息区域展示成色，例如：

```tsx
{product.condition && (
  <div>
    <span className="text-muted-foreground">{t('condition')}: </span>
    <span>{t(`condition_${product.condition}`)}</span>
  </div>
)}
```

### 6. 商品卡片（可选）

**文件**：`src/components/ecommerce/product-card/ProductCardView.tsx`

如需在列表/店铺等场景展示成色，可在商品卡片中增加成色标签，仅当 `condition` 存在时显示。

### 7. DTO 与 Mapper

**文件**：`src/lib/product-card/types.ts`

在 `ListProductContentDTO` 中增加：

```ts
condition: 'new' | 'like_new' | 'ninety_five' | 'ninety' | 'eighty' | 'seventy_or_below' | null
```

**文件**：`src/lib/product-card/mappers.ts`

在 `mapFeedProductToListProductDTO` 等 mapper 中，从 raw 中传入 `condition`。

**文件**：`src/lib/hooks/useProducts.ts`

`Product` 接口增加 `condition` 字段。

### 8. 翻译

**文件**：`src/messages/zh.json`、`src/messages/en.json`

在 `seller` 命名空间下增加：

```json
{
  "condition": "成色" / "Condition",
  "conditionNew": "全新" / "New",
  "conditionLikeNew": "99新" / "Like New",
  "conditionNinetyFive": "95新" / "95% New",
  "conditionNinety": "9成新" / "90% New",
  "conditionEighty": "8成新" / "80% New",
  "conditionSeventyOrBelow": "7成新及以下" / "70% or Below"
}
```

在 `products` 命名空间下增加相同 key（供详情页使用），或复用 `seller` 中的翻译。

---

## 四、实施步骤（推荐顺序）

| 步骤 | 操作 | 文件 |
|------|------|------|
| 1 | 新建数据库迁移 | `supabase/migrations/242_add_product_condition.sql` |
| 2 | 更新 database 类型 | `src/types/database.ts` |
| 3 | 补充翻译 | `zh.json`、`en.json` |
| 4 | 创建页：formData + UI + 提交 | `create/page.tsx` |
| 5 | 编辑页：formData + 加载 + UI + 提交 | `edit/page.tsx` |
| 6 | 详情页：展示成色 | `ProductPageClient.tsx` |
| 7 | DTO、mapper、useProducts | `types.ts`、`mappers.ts`、`useProducts.ts` |
| 8 | （可选）商品卡片展示 | `ProductCardView.tsx` |

---

## 五、UI 规范

### 创建/编辑页成色选择

- 使用 `<select>` 或与尺寸区块风格一致的下拉
- 选项：空（—）、全新、99新、95新、9成新、8成新、7成新及以下
- value 对应上述枚举值
- 非必填，可不选

### 详情页展示

- 仅在 `product.condition` 有值时展示
- 文案格式：`成色：全新`（或对应翻译）
- 位置建议：价格、库存附近的基础信息区

---

## 六、与购物车/订单的关系

成色为商品级属性，不是购买时可选的变体，因此：

- 不需要在 `CartItem` 或 `order_items` 中增加 `condition`
- 购物车、结算页沿用商品主数据中的 `condition` 即可

---

## 七、验证步骤

1. 执行迁移：`npx supabase db push` 或 `npx supabase migration up`
2. 创建商品：选择不同成色，提交后检查 `products.condition`
3. 编辑商品：修改成色，保存后检查更新
4. 详情页：有/无成色时展示是否符合预期
5. 多语言：切换 zh/en 检查成色文案
6. 老数据：未设置成色的商品应正常显示，无报错

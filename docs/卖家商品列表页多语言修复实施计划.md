# 卖家商品列表页多语言修复实施计划

## 问题描述

**现象**：访问 `http://localhost:3000/en/seller/products` 时，商品卡片显示的商品名、描述始终为中文（应为英文或根据当前 locale 选择）。

**目标**：在 `/en/` 路由下，商品名、描述应按 locale 显示英文（优先使用 `name_translated` / `description_translated`）；在 `/zh/` 下显示中文（原文）。

---

## 根因分析

| 项目 | 说明 |
|------|------|
| 问题文件 | `src/app/[locale]/(main)/seller/products/page.tsx` |
| 根因 | 列表页直接使用 `product.name`、`product.description`，未根据 locale 选择原文或译文 |
| 已有能力 | 项目已有 `getDisplayContent(locale, contentLang, content, contentTranslated)` 及 `content_lang`、`name_translated`、`description_translated` 字段 |
| 参考实现 | `ProductCardView.tsx`、编辑页 `edit/page.tsx` 已正确使用 `getDisplayContent` |

### 数据库字段（products 表）

- `content_lang`：原文语言（'zh' \| 'en'）
- `name` / `name_translated`：商品名（原文 / AI 译文）
- `description` / `description_translated`：商品描述（原文 / AI 译文）

### 当前代码问题

```tsx
// 第 129-135 行：始终显示原文
alt={product.name}
<h3>{product.name}</h3>
<p>{product.description}</p>
```

当 `content_lang === 'zh'` 且 locale 为 `en` 时，应显示 `name_translated`、`description_translated`，但页面未做此判断。

---

## 修复方案

### 1. 引入依赖

- `useLocale`（`next-intl`）
- `getDisplayContent`（`@/lib/ai/display-translated`）

### 2. 展示逻辑调整

对每个商品卡片：

1. 使用 `useLocale()` 获取当前 locale；
2. 使用 `getDisplayContent(locale, product.content_lang ?? null, product.name, product.name_translated)` 得到 `displayName`；
3. 使用 `getDisplayContent(locale, product.content_lang ?? null, product.description, product.description_translated)` 得到 `displayDescription`；
4. 将 `product.name`、`product.description` 替换为 `displayName`、`displayDescription`；
5. 图片 `alt` 使用 `displayName`。

### 3. 数据源确认

当前查询为 `.select('*')`，已包含 `content_lang`、`name_translated`、`description_translated`，无需修改查询。

---

## 实施步骤

1. **修改 `src/app/[locale]/(main)/seller/products/page.tsx`**
   - 添加 `import { useLocale } from 'next-intl'`
   - 添加 `import { getDisplayContent } from '@/lib/ai/display-translated'`
   - 在组件内调用 `const locale = useLocale()`
   - 在 `products.map` 回调内，对每个 `product` 计算 `displayName` 与 `displayDescription`
   - 将 `alt={product.name}`、`<h3>{product.name}</h3>`、`<p>{product.description}</p>` 替换为上述变量

2. **验证**
   - 在 `/zh/seller/products` 下，商品名、描述应为原文（中文）
   - 在 `/en/seller/products` 下，有 `name_translated` 时显示英文，无时回退原文
   - 切换顶栏语言，卡片内容应随 locale 变化

---

## 涉及文件

| 文件 | 改动 |
|------|------|
| `src/app/[locale]/(main)/seller/products/page.tsx` | 增加 useLocale、getDisplayContent，卡片展示改用 displayName/displayDescription |

---

## 风险与注意事项

- `getDisplayContent` 在无译文或老数据时会回退原文，无需额外兼容。
- 若商品无 `content_lang`，函数内部会通过 `detectContentLanguage` 推断，与顶栏语言切换一致。
